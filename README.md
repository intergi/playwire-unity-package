<H1 align="center">Playwire Unity SDK</H1>

<p align="center">
    <a><img alt="Version" src="https://img.shields.io/badge/version-3.1.0-blue"></a>
    <a href="https://unity.com/"><img alt="Unity 2019.4.30f1 (LTS)" src="https://img.shields.io/badge/Unity 2019.4.30f1 (LTS)-orange.svg?style=flat"></a>
</p>

---

# Requirements

- Unity 2019.4.30f1+ (LTS)
- iOS 11.0+
- Android 5.0+ (API 21+)

# Installation

Follow these steps to import the `Playwire Unity SDK` to your project:

1. Download the latest the `Playwire Unity SDK` package [here](https://github.com/intergi/playwire-unity-package).
2. Open the Unity Editor, go to `Assets > Import Package > Custom Package`. Keep all the files selected in the Importing Package window, then click Import.
<img src="readme-resources/package_import.png" alt="package-import" width="600"/>

3. Once importing has been finished, the set of dependencies should be resolved. Follow the [Dependencies installation](#dependencies-installation) section to resolve all required dependencies.
4. Find configuration files that your Playwire account rep provided to you, they are usually sent via email. Verify that you have files for both iOS and Android platforms. You must copy and paste them to `Assets/Playwire/Plugins/Resources/iOS` and `Assets/Playwire/Plugins/Resources/Android` respectively. Follow the [Configuration](#configuration) section to check how to work with configuration files, escpecially if you use a custom configuration filename.
<img src="readme-resources/resources.png" alt="resources"/>

5. Build and run your Unity project.

# Dependencies installation

The `Playwire Unity SDK` is configured to use the [External Dependency Manager](https://github.com/googlesamples/unity-jar-resolver) (formerly Play Services Resolver/Jar Resolver). This is a complex tool for managing and automating dependencies for iOS (CocoaPods) and Android (Gradle).

See list of options to resolve and adjust settings in `Assets > External Dependency Manager`. If it is not available for you, go to `File > Build settings > Select iOS or Android > Switch Platform`.

> **Note**: If you are integrating an updated version of `Playwire Unity SDK` on top of existing one, you may face an issue while building iOS project's workspace. The thing is Unity fails to download newest podspecs from remote repository to your local repository (`Users/<USER_NAME>/.cocoapods/repo`) while building iOS project. Thus you need to do it by yourselves just by running command to actualize local `Playwire iOS` pods. By default pod repo's name is `intergi` and to update latest podspecs, please run `pod repo update intergi` in Terminal.

## iOS

The External Dependency Manager uses [CocoaPods](https://guides.cocoapods.org/using/getting-started.html#getting-started) to install the iOS dependencies.

All dependencies are resolved automatically during the build process. The build scripts run specified pod commands to install dependencies and configure an iOS project accordingly to the settings. You can check and adjust resolver settings in `Assets > External Dependency Manager > iOS Resolver > Settings`.

## Android

The External Dependency Manager uses [Gradle](https://docs.gradle.org/current/userguide/getting_started.html) to install the Android dependencies.

To resolve required dependencies for Android you should follow next steps:

1. As the `Playwire Unity SDK` consumes native Android SDK from the remote GitHub Packages repository, even though such SDK is accessible publicly there, GitHub still requires to do authentication, that is why the `Playwire Unity SDK` is configured to have **`keystore.properties`** that should contain credentials to access GitHub package. See official [GitHub Package's guide](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-gradle-registry) to get more details about Github authentication.

> **Note**: To learn more about `keystore.properties` usage, please visit official [Android Developer's Tutorial](https://developer.android.com/studio/publish/app-signing#secure-shared-keystore)

You have to create a `keystore.properties` file by yourself using the template below and put to `Assets/Playwire/Plugin/Resources/Android` directory.

```
maven_repo_read_url=https://maven.pkg.github.com/intergi/playwire-android-binaries
maven_repo_read_username=<GITHUB_USERNAME>
maven_repo_read_password=<GITHUB_ACCESS_TOKEN>
```

2. Go to `Edit > Project Settings > Player > Settings for Android > Publishing Settings` and check `Custom Base Gradle Template`. 

<img src="readme-resources/player_android_settings.png" alt="player_android_settings" width="700"/>

Once you check this option, you will see the path where this file is stored. You should open and modify it with next changes:

```gradle
// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN

def keystorePropertiesFile = rootProject.file("keystore.properties")
def keystoreProperties = new Properties()
keystoreProperties.load(new FileInputStream(keystorePropertiesFile))

// ...

allprojects {
    // ...
    repositories {**ARTIFACTORYREPOSITORY**
        // ...
        maven {
            name = "GitHubPackages"
            url = uri(keystoreProperties['maven_repo_read_url'])
            credentials {
                username = keystoreProperties['maven_repo_read_username']
                password = keystoreProperties['maven_repo_read_password']
            }
        }
        // ...
    }
    // ...
}
```
3. Go to `Edit > Project Settings > Player > Settings for Android > Publishing Settings` and check `Custom Main Gradle Template`. Also, please verify that `Patch mainTemplate.gradle` option is enabled in `Assets > External Dependence Manager > Android Resolver > Settings`. Once you did previous steps, please perform automatic dependency resolving by clicking `Assets > External Dependence Manager > Android Resolver > Force Resolve`.

<img src="readme-resources/patch_main_gradle.png" alt="patch_main_gradle" width="700"/>

# Usage

## Initialization

To start working with the `Playwire Unity SDK`, you must first initialize it. This step is required, otherwise SDK will not make any ad requests and ads will not be available for your users.
In most cases, it makes sense to do this in your appâ€™s [`Start()`](https://docs.unity3d.com/ScriptReference/MonoBehaviour.Start.html) method.

```csharp
PlaywireSDK.InitializeSDK();
```

Once the `Playwire Unity SDK` has been initialized, you will receive the `PlaywireSDKCallback.OnSDKInitializedEvent`.

> **Note**: In case you call any method without initialization, SDK will notify you about this in the IDE logs window.

## Configuration

The `Playwire Unity SDK` retrieves data for configuration from the JSON file, that should be given to you by Playwire (If you do not have such config file, please contact your Playwire account rep with any questions or technical issues).
By default the `Playwire Unity SDK` is looking for the **`PWConfigFile.json`** file, but you can provide a custom filename and set it as config file for the `Playwire Unity SDK`.

```csharp
string configName = "CUSTOM_CONFIG_FILE_NAME";
PlaywireSDK.SetConfigName(configName);

PlaywireSDK.InitializeSDK();
```

If you use a custom filename, you have to provide some modifications for `BuildPostProcessor`. There is a service that simplifies the `Playwire Unity SDK` integration, because it takes over iOS and Android projects adjustments, such as, setup required identifiers, settings and permissions, etc. We do not recommend to modify it unless you have to, such as in case above.
Open `Assets/Playwire/Editor/BuildPostProcessor.cs` and replace `iOSConfigurationFile` and `androidConfigurationFile` values with your custom filename. This step is mandatory to avoid runtime issues.

> **Note**: We recommend you to set a custom config filename before initialization to avoid any issues related to SDK configuration.
## Ad Units

### Banner

To display a banner you should make a request to fetch an ad content first. To load a banner ad you have to provide the ad unit and position where a banner view will be placed.

> **Note**: If your Unity project is implemented on both iOS and Android platforms, a banner will be placed at the same position on the screen, but you must use different ad units for each platform. See `UNITY_IOS` and `UNITY_ANDROID` platform #define directives as a possible solution.

```csharp
string BannerAdUnitId = "Banner";
PlaywireSDK.LoadBanner(BannerAdUnitId, PlaywireSDKBase.AdPosition.BottomCenter);
```

See table with available banner positions below.

| PlaywireSDKBase.AdPosition     | Description                                                 |
| ------------------------------ | ----------------------------------------------------------- |
| TopLeft                        | A banner will be placed at the top left of the screen.      |
| TopCenter                      | A banner will be placed at the top center of the screen.    |
| TopRight                       | A banner will be placed at the top right of the screen.     |
| CenterLeft                     | A banner will be placed at the center left of the screen.   |
| Center                         | A banner will be placed at the center of the screen.        |
| CenterRight                    | A banner will be placed at the center right of the screen.  |
| BottomLeft                     | A banner will be placed at the bottom left of the screen.   |
| BottomCenter                   | A banner will be placed at the bottom center of the screen. |
| BottomRight                    | A banner will be placed at the bottom right of the screen.  |

Once the banner has been loaded successfully, you will receive the `PlaywireSDKCallback.Banner.OnLoadedEvent`, otherwise - `PlaywireSDKCallback.Banner.OnFailedToLoadEvent`.

In case the banner is ready to be displayed, you can show it on the screen at the position you passed during loading or hide it.

```csharp
string BannerAdUnitId = "Banner";

PlaywireSDK.ShowBanner(BannerAdUnitId);

PlaywireSDK.HideBanner(BannerAdUnitId);
```

The `PlaywireSDKCallback.Banner` provides the banner-related callbacks to inform you about a banner ad lifecycle. You can subscribe to be notified about events and handle it.

```csharp
void OnEnable () 
{
    // ...
    PlaywireSDKCallback.Banner.OnLoadedEvent += OnBannerLoadedEvent;
    PlaywireSDKCallback.Banner.OnFailedToLoadEvent += OnBannerFailedToLoadEvent;
    // ...
}

void OnBannerLoadedEvent(PlaywireSDKEventArgs args) 
{
    // ...
    PlaywireSDK.ShowBanner(args.AdUnitId);
    // ...
}

void OnBannerFailedToLoadEvent(PlaywireSDKEventArgs args) 
{
    // ...
}
```

The banner-related actions are listed below.

```csharp
... PlaywireSDKCallback {
    ... Banner {
        /// It is fired when the banner ad successfully loaded content.
        public static event Action<PlaywireSDKEventArgs> OnLoadedEvent

        /// It is fired when the banner ad failed to load content.
        public static event Action<PlaywireSDKEventArgs> OnFailedToLoadEvent

        /// It is fired when the banner ad presented content.
        public static event Action<PlaywireSDKEventArgs> OnOpenedEvent

        /// It is fired when the banner ad dismissed content.
        public static event Action<PlaywireSDKEventArgs> OnClosedEvent

        /// It is fired when a click has been recorded for the banner ad.
        public static event Action<PlaywireSDKEventArgs> OnClickedEvent

        /// It is fired when an impression has been recorded for the banner ad.
        public static event Action<PlaywireSDKEventArgs> OnRecordedImpressionEvent
    }
}
```

### Interstitial

To display an interstitial you should make a request to fetch an ad content first. To load an interstitial ad you have to provide the ad unit.
We recommend requesting an interstitial ad a short while before you plan to present it for your users because the loading process can take time.

```csharp
string InterstitialAdUnitId = "Interstitial";
PlaywireSDK.LoadInterstitial(InterstitialAdUnitId);
```

> **Note**: The interstitial is a one-time-use object. This means that once an interstitial ad is shown, it must be loaded again. You can check if the interstitial is ready to be presented via `PlaywireSDK.IsInterstitialReady(string adUnitId)` method.

Once the interstitial has been loaded successfully, you will receive the `PlaywireSDKCallback.Interstitial.OnLoadedEvent`, otherwise - `PlaywireSDKCallback.Interstitial.OnFailedToLoadEvent`.
In case the interstitial is ready to be displayed, you can present full screen content.

```csharp
string InterstitialAdUnitId = "Interstitial";
PlaywireSDK.ShowInterstitial(InterstitialAdUnitId);
```

> **Note**: The interstitial ad content will be presented only if it was loaded and was not shown before, otherwise `PlaywireSDKCallback.Interstitial.OnFailedToOpenEvent` will be invoked.

The `PlaywireSDKCallback.Interstitial` provides the interstitial-related callbacks to inform you about an interstitial ad lifecycle. You can subscribe to be notified about events and handle it.

```csharp
void OnEnable () 
{
    // ...
    PlaywireSDKCallback.Interstitial.OnLoadedEvent += OnInterstitialLoadedEvent;
    PlaywireSDKCallback.Interstitial.OnFailedToLoadEvent += OnInterstitialFailedToLoadEvent;
    // ...
}

void OnInterstitialLoadedEvent(PlaywireSDKEventArgs args) 
{
    // ...
    bool isInterstitialReady = PlaywireSDK.IsInterstitialReady(args.AdUnitId);

    if (!isInterstitialReady) {
        // Load interstitial again or show error.
        return;
    }
    PlaywireSDK.ShowInterstitial(args.AdUnitId);
    // ...
}

void OnInterstitialFailedToLoadEvent(PlaywireSDKEventArgs args) 
{
    // ...
}
```

The interstitial-related actions are listed below.

```csharp
... PlaywireSDKCallback {
    ... Interstitial {
        /// It is fired when the interstitial ad successfully loaded full screen content and ready to be presented.
        public static event Action<PlaywireSDKEventArgs> OnLoadedEvent

        /// It is fired when the interstitial ad failed to load full screen content.
        public static event Action<PlaywireSDKEventArgs> OnFailedToLoadEvent

        /// It is fired when the interstitial ad presented full screen content.
        public static event Action<PlaywireSDKEventArgs> OnOpenedEvent

        /// It is fired when the interstitial ad failed to present full screen content.
        public static event Action<PlaywireSDKEventArgs> OnFailedToOpenEvent

        /// It is fired when an interstitial ad dismissed full screen content and the user goes back to the application screen.
        public static event Action<PlaywireSDKEventArgs> OnClosedEvent

        /// It is fired when an impression has been recorded for the interstitial ad.
        public static event Action<PlaywireSDKEventArgs> OnRecordedImpressionEvent

        /// It is fired when a click has been recorded for the interstitial ad.
        public static event Action<PlaywireSDKEventArgs> OnClickedEvent
    }
}
```

### Rewarded

To display a rewarded you should make a request to fetch an ad content first. To load a rewarded ad you have to provide the ad unit.
We recommend requesting a rewarded ad a short while before you plan to present it for your users because the loading process can take time.

```csharp
string RewardedAdUnitId = "Rewarded";
PlaywireSDK.LoadRewarded(RewardedAdUnitId);
```

> **Note**: The rewarded is a one-time-use object. This means that once an rewarded ad is shown, it must be loaded again. You can check if the rewarded is ready to be presented via `PlaywireSDK.IsRewardedReady(string adUnitId)` method.

Once the rewarded has been loaded successfully, you will receive the `PlaywireSDKCallback.Rewarded.OnLoadedEvent`, otherwise - `PlaywireSDKCallback.Rewarded.OnFailedToLoadEvent`.
In case the rewarded is ready to be displayed, you can present full screen content.

```csharp
string RewardedAdUnitId = "Rewarded";
PlaywireSDK.ShowRewarded(RewardedAdUnitId);
```

> **Note**: The rewarded ad content will be presented only if it was loaded and was not shown before, otherwise `PlaywireSDKCallback.Rewarded.OnFailedToOpenEvent` will be invoked.

The `PlaywireSDKCallback.Rewarded` provides the rewarded-related callbacks to inform you about a rewarded ad lifecycle. You can subscribe to be notified about events and handle it.

```csharp
void OnEnable () 
{
    // ...
    PlaywireSDKCallback.Rewarded.OnLoadedEvent += OnRewardedLoadedEvent;
    PlaywireSDKCallback.Rewarded.OnFailedToLoadEvent += OnRewardedFailedToLoadEvent;
    // ...
}

void OnRewardedLoadedEvent(PlaywireSDKEventArgs args) 
{
    // ...
    bool isRewardedReady = PlaywireSDK.IsRewardedReady(args.AdUnitId);

    if (!isRewardedReady) {
        // Load the rewarded again or show error.
        return;
    }
    PlaywireSDK.ShowRewarded(args.AdUnitId);
}

void OnRewardedFailedToLoadEvent(PlaywireSDKEventArgs args) 
{
    // ...
}
```

The rewarded-related actions are listed below.

```csharp
... PlaywireSDKCallback {
    ... Rewarded {
        /// It is fired when the rewarded ad successfully loaded full screen content and ready to be presented.
        public static event Action<PlaywireSDKEventArgs> OnLoadedEvent

        /// It is fired when the rewarded ad failed to load full screen content.
        public static event Action<PlaywireSDKEventArgs> OnFailedToLoadEvent

        /// It is fired when the rewarded ad presented full screen content.
        public static event Action<PlaywireSDKEventArgs> OnOpenedEvent

        /// It is fired when the rewarded ad failed to present full screen content.
        public static event Action<PlaywireSDKEventArgs> OnFailedToOpenEvent

        /// It is fired when an rewarded ad dismissed full screen content and the user goes back to the application screen.
        public static event Action<PlaywireSDKEventArgs> OnClosedEvent

        /// It is fired when an impression has been recorded for the rewarded ad.
        public static event Action<PlaywireSDKEventArgs> OnRecordedImpressionEvent

        /// It is fired when a reward has been earned.
        public static event Action<PlaywireSDKEventArgs> OnEarnedEvent

        /// It is fired when a click has been recorded for the rewarded ad.
        public static event Action<PlaywireSDKEventArgs> OnClickedEvent
    }
}
```